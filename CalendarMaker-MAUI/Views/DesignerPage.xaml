<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
             x:Class="CalendarMaker_MAUI.Views.DesignerPage"
             Title="Designer">
    <Grid RowDefinitions="*" Padding="12" ColumnDefinitions="260,*" ColumnSpacing="12">
        <ScrollView Grid.Column="0" VerticalScrollBarVisibility="Always" Padding="0,0,10,0">
            <VerticalStackLayout Spacing="10">
                <Label Text="Designer" FontAttributes="Bold" />
                <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="6">
                    <Button Text="Prev" 
                            Command="{Binding NavigatePageCommand}" 
                            CommandParameter="{x:Int32 -1}"
                            Grid.Column="0" />
                    <Label Text="{Binding PageLabel}" 
                           Grid.Column="1" 
                           VerticalTextAlignment="Center" 
                           HorizontalTextAlignment="Center" />
                    <Button Text="Next" 
                            Command="{Binding NavigatePageCommand}" 
                            CommandParameter="{x:Int32 1}"
                            Grid.Column="2" />
                    <!-- Settings Cog Icon -->
                    <Border Grid.Column="3"
                           WidthRequest="36" 
                           HeightRequest="36"
                           BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                           Padding="6" 
                           Stroke="Transparent" 
                           StrokeThickness="0"
                           StrokeShape="RoundRectangle 8,8,8,8">
                        <Grid>
                            <!-- Settings Cog Icon Path -->
                            <shapes:Path Stroke="White" 
                                         StrokeThickness="2" 
                                         Fill="Transparent"
                                         Data="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" />
                        </Grid>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ShowProjectSettingsCommand}" />
                        </Border.GestureRecognizers>
                    </Border>
                </Grid>

                <Button Text="Add Photo" 
                        Command="{Binding ImportPhotosCommand}" />

                <BoxView HeightRequest="1" Color="#DDD" />
                <Label Text="Layout" FontAttributes="Bold" />
                <Button Text="Flip Layout" 
                        Command="{Binding FlipLayoutCommand}" />
        
                <!-- Split slider with reset -->
                <Grid x:Name="SplitControlGrid" 
                      ColumnDefinitions="Auto,*,Auto,Auto" 
                      RowDefinitions="Auto"
                      IsVisible="{Binding SplitControlVisible}">
                    <Label Text="Split" />
                    <Slider Grid.Column="1" 
                            Minimum="0.3" 
                            Maximum="0.7" 
                            Value="{Binding SplitRatio}" />
                    <Label Grid.Column="2" 
                           Text="{Binding SplitRatio, StringFormat='{0:P0}'}" />
                    <Border x:Name="SplitResetBtn" 
                            Grid.Column="3"
                            WidthRequest="36" 
                            HeightRequest="36"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            Padding="6" 
                            Stroke="Transparent" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8,8,8,8">
                        <Grid>
                            <shapes:Path Stroke="White" StrokeThickness="2" Data="M23 4 L23 10 L17 10" />
                            <shapes:Path Stroke="White" StrokeThickness="2" Data="M20.49 15 A9 9 0 1 1 22.62 6" />
                        </Grid>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ResetSplitCommand}" />
                        </Border.GestureRecognizers>
                    </Border>
                </Grid>
            
                <!-- Photo layout picker -->
                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                    <Label Text="Photo Layout" />
                    <Picker Grid.Column="1" 
                            HorizontalOptions="FillAndExpand"
                            ItemsSource="{Binding PhotoLayoutNames}"
                            SelectedIndex="{Binding SelectedPhotoLayoutIndex}" />
                </Grid>
        
                <!-- Zoom slider with reset -->
                <Grid ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto">
                    <Label Text="Photo Zoom" />
                    <Slider Grid.Column="1" 
                            Minimum="0.5" 
                            Maximum="3.0" 
                            Value="{Binding ZoomValue}"
                            IsEnabled="{Binding ZoomSliderEnabled}" />
                    <Label Grid.Column="2" 
                           Text="{Binding ZoomValue, StringFormat='{0:F2}x'}" />
                    <Border x:Name="ZoomResetBtn" 
                            Grid.Column="3"
                            WidthRequest="36" 
                            HeightRequest="36"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            Padding="6" 
                            Stroke="Transparent" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8,8,8,8">
                        <Grid>
                            <shapes:Path Stroke="White" StrokeThickness="2" Data="M23 4 L23 10 L17 10" />
                            <shapes:Path Stroke="White" StrokeThickness="2" Data="M20.49 15 A9 9 0 1 1 22.62 6" />
                        </Grid>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ResetZoomCommand}" />
                        </Border.GestureRecognizers>
                    </Border>
                </Grid>
                <BoxView HeightRequest="1" Color="#DDD" />
                <Label Text="Export" FontAttributes="Bold" />
                <Button Text="Export Month (PDF)" 
                        Command="{Binding ExportCurrentPageCommand}" />
                <Button Text="Export Cover (PDF)" 
                        Command="{Binding ExportCoverCommand}" />
                <Button Text="Export Full Year (PDF)" 
                        Command="{Binding ExportYearCommand}" />
                <Button Text="Export Double-Sided (PDF)" 
                        Command="{Binding ExportDoubleSidedCommand}" />
                <Button Text="Back" 
                        Command="{Binding GoBackCommand}" />
            </VerticalStackLayout>
        </ScrollView>
        <Border Grid.Column="1" Stroke="LightGray" StrokeThickness="1" Padding="8">
            <ContentView x:Name="CanvasHost" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" />
        </Border>
    </Grid>
</ContentPage>